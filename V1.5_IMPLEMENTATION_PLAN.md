# 🚀 v1.5 Enhanced UX - Implementation Plan

## Overview

This document outlines the implementation plan for **v1.5 Enhanced UX**, building on the solid v1.0 foundation to provide visual, interactive, and intelligent user experiences.

---

## 📋 Feature Breakdown

### 1. Web Dashboard for Visual Timeline

**Goal**: Provide a beautiful, interactive web interface for visualizing Claude Code sessions

#### Architecture
```
┌─────────────────────────────────────────────────────────┐
│                    Web Dashboard                         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   Timeline   │  │  Diff Viewer │  │   Snapshot   │  │
│  │     View     │  │              │  │   Details    │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                          ▲
                          │ REST API
                          ▼
┌─────────────────────────────────────────────────────────┐
│               FastAPI Backend Server                     │
│  - Snapshot API endpoints                                │
│  - Real-time WebSocket events                            │
│  - Diff generation service                               │
└─────────────────────────────────────────────────────────┘
                          ▲
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│            Existing SnapshotEngine                       │
│         (No changes needed - just expose via API)        │
└─────────────────────────────────────────────────────────┘
```

#### Implementation Steps

**Phase 1: Backend API (Week 1)**
```python
# claude_rewind/web/server.py
from fastapi import FastAPI, WebSocket
from fastapi.staticfiles import StaticFiles
from claude_rewind.core.snapshot_engine import SnapshotEngine

app = FastAPI(title="Claude Code Rewind Dashboard")

# Endpoints:
# GET /api/snapshots - List all snapshots
# GET /api/snapshots/{id} - Get snapshot details
# GET /api/diff/{snapshot_a}/{snapshot_b} - Get diff
# POST /api/rollback/{id} - Execute rollback
# WebSocket /ws/monitor - Real-time snapshot events
```

**Phase 2: Frontend (Week 2-3)**
```javascript
// Technology stack:
// - React + TypeScript
// - TailwindCSS for styling
// - D3.js for timeline visualization
// - Monaco Editor for diff viewing
// - WebSocket for real-time updates

// Key components:
// - TimelineChart: Interactive timeline with zoom/pan
// - DiffViewer: Side-by-side file comparison
// - SnapshotCard: Detailed snapshot information
// - RollbackModal: Preview and confirm rollbacks
```

**Phase 3: CLI Integration (Week 3)**
```bash
# New CLI commands:
claude-rewind serve --port 8080 --host localhost
claude-rewind dashboard  # Opens browser automatically
```

#### Deliverables
- ✅ FastAPI backend with REST endpoints
- ✅ React frontend with interactive timeline
- ✅ WebSocket real-time updates
- ✅ Integrated into CLI with `serve` and `dashboard` commands
- ✅ Comprehensive documentation

---

### 2. VSCode Extension Integration

**Goal**: Bring Claude Code Rewind directly into the VSCode editor

#### Architecture
```
┌─────────────────────────────────────────────────────────┐
│                VSCode Extension                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   Timeline   │  │  Inline Diff │  │   Snapshot   │  │
│  │   Sidebar    │  │    Markers   │  │   Actions    │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                          ▲
                          │ IPC / CLI
                          ▼
┌─────────────────────────────────────────────────────────┐
│          claude-rewind CLI (existing)                    │
└─────────────────────────────────────────────────────────┘
```

#### Implementation Steps

**Phase 1: Extension Scaffold (Week 1)**
```typescript
// vscode-extension/src/extension.ts
import * as vscode from 'vscode';
import { TimelineProvider } from './providers/timeline';
import { DiffProvider } from './providers/diff';
import { SnapshotManager } from './managers/snapshot';

export function activate(context: vscode.ExtensionContext) {
    // Register commands:
    // - claude-rewind.showTimeline
    // - claude-rewind.diffCurrent
    // - claude-rewind.rollbackToSnapshot
    // - claude-rewind.createSnapshot
}
```

**Phase 2: Timeline Sidebar (Week 2)**
```typescript
// TimelineWebviewProvider
// - Shows interactive timeline in sidebar
// - Click snapshot to see details
// - Right-click for context menu (rollback, diff, etc.)
```

**Phase 3: Inline Diff Markers (Week 2)**
```typescript
// DiffDecorationProvider
// - Shows gutter icons for changed lines
// - Hover to see previous version
// - Click to rollback individual changes
```

**Phase 4: Command Palette Integration (Week 3)**
```typescript
// Commands available via Cmd+Shift+P:
// - "Claude Rewind: Show Timeline"
// - "Claude Rewind: Diff with Previous"
// - "Claude Rewind: Rollback to Snapshot"
// - "Claude Rewind: Create Manual Snapshot"
```

#### Deliverables
- ✅ Published VSCode extension on marketplace
- ✅ Timeline sidebar view
- ✅ Inline diff markers and previews
- ✅ Command palette integration
- ✅ Extension documentation and tutorial

---

### 3. Real-Time Diff Streaming

**Goal**: Show live diffs as Claude Code makes changes

#### Architecture
```
┌─────────────────────────────────────────────────────────┐
│              File Watcher (inotify)                      │
│         Detects file changes in real-time                │
└─────────────────────────────────────────────────────────┘
                          ▲
                          │ File events
                          ▼
┌─────────────────────────────────────────────────────────┐
│            Diff Streaming Engine                         │
│  - Maintains in-memory pre-change state                  │
│  - Generates incremental diffs on write                  │
│  - Broadcasts via WebSocket                              │
└─────────────────────────────────────────────────────────┘
                          ▲
                          │ WebSocket
                          ▼
┌─────────────────────────────────────────────────────────┐
│         Client (Web Dashboard / VSCode)                  │
│         Shows live diff as changes happen                │
└─────────────────────────────────────────────────────────┘
```

#### Implementation Steps

**Phase 1: Diff Streaming Engine (Week 1)**
```python
# claude_rewind/streaming/diff_streamer.py
from watchdog.observers import Observer
from watchdog.events import FileSystemEventHandler

class DiffStreamingEngine:
    """Real-time diff generation as files change."""

    def __init__(self, snapshot_engine, websocket_manager):
        self.snapshot_engine = snapshot_engine
        self.websocket_manager = websocket_manager
        self._pre_change_states = {}  # In-memory cache

    def start_streaming(self):
        """Start watching for file changes."""
        observer = Observer()
        observer.schedule(self._event_handler, path=self.project_root, recursive=True)
        observer.start()

    def _on_file_modified(self, file_path):
        """Generate and stream diff when file changes."""
        pre_state = self._pre_change_states.get(file_path)
        post_state = self._read_file(file_path)

        diff = self._generate_incremental_diff(pre_state, post_state)
        self.websocket_manager.broadcast({
            'type': 'live_diff',
            'file': file_path,
            'diff': diff,
            'timestamp': time.time()
        })

        # Update pre-change state for next iteration
        self._pre_change_states[file_path] = post_state
```

**Phase 2: WebSocket Integration (Week 1)**
```python
# Add to claude_rewind/web/server.py
@app.websocket("/ws/streaming")
async def streaming_endpoint(websocket: WebSocket):
    await websocket.accept()

    # Register client for live diff broadcasts
    diff_streamer.register_client(websocket)

    try:
        while True:
            await websocket.receive_text()  # Keep connection alive
    except WebSocketDisconnect:
        diff_streamer.unregister_client(websocket)
```

**Phase 3: Client-Side Display (Week 2)**
```javascript
// React component for live diff view
function LiveDiffViewer() {
    const [liveDiffs, setLiveDiffs] = useState([]);

    useEffect(() => {
        const ws = new WebSocket('ws://localhost:8080/ws/streaming');

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'live_diff') {
                setLiveDiffs(prev => [...prev, data]);
            }
        };

        return () => ws.close();
    }, []);

    return (
        <div className="live-diff-container">
            {liveDiffs.map(diff => (
                <DiffBlock key={diff.timestamp} diff={diff} />
            ))}
        </div>
    );
}
```

#### Deliverables
- ✅ Real-time file watching with diff generation
- ✅ WebSocket broadcasting system
- ✅ Web dashboard live diff view
- ✅ VSCode extension live diff panel
- ✅ Performance optimization for large files

---

### 4. Smart Rollback Suggestions

**Goal**: AI-powered suggestions for safe and intelligent rollbacks

#### Architecture
```
┌─────────────────────────────────────────────────────────┐
│            Rollback Analysis Engine                      │
│  - Analyzes snapshot history and current state           │
│  - Identifies risky vs safe rollback points              │
│  - Suggests partial rollbacks                            │
└─────────────────────────────────────────────────────────┘
                          ▲
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│            Suggestion Generator                          │
│  - Evaluates impact of each rollback option              │
│  - Ranks suggestions by safety and relevance             │
│  - Provides human-readable explanations                  │
└─────────────────────────────────────────────────────────┘
```

#### Implementation Steps

**Phase 1: Rollback Analyzer (Week 1)**
```python
# claude_rewind/suggestions/rollback_analyzer.py
from claude_rewind.rollback.analyzer import ChangeAnalyzer

class RollbackSuggestionEngine:
    """Intelligent rollback suggestion system."""

    def analyze_rollback_options(self, target_snapshot_id: str) -> List[Suggestion]:
        """Analyze potential rollback and generate suggestions."""

        target = self.db_manager.get_snapshot(target_snapshot_id)
        current = self._get_current_state()

        suggestions = []

        # Suggestion 1: Full rollback
        full_impact = self._analyze_full_rollback(target, current)
        suggestions.append(Suggestion(
            type="full",
            safety_score=self._calculate_safety_score(full_impact),
            description=f"Rollback all {len(full_impact.files)} files",
            risk_level="medium" if full_impact.has_manual_changes else "low",
            explanation=self._generate_explanation(full_impact)
        ))

        # Suggestion 2: Selective rollback (only problematic files)
        problematic_files = self._identify_problematic_files(target, current)
        if problematic_files:
            selective_impact = self._analyze_selective_rollback(problematic_files)
            suggestions.append(Suggestion(
                type="selective",
                files=problematic_files,
                safety_score=self._calculate_safety_score(selective_impact),
                description=f"Rollback only {len(problematic_files)} problematic files",
                risk_level="low",
                explanation=f"These files likely contain the issue: {', '.join(problematic_files)}"
            ))

        # Suggestion 3: Preserve manual changes
        if full_impact.has_manual_changes:
            manual_files = self._identify_manual_changes(target, current)
            suggestions.append(Suggestion(
                type="preserve_manual",
                preserve_files=manual_files,
                safety_score=0.9,
                description=f"Rollback but preserve {len(manual_files)} manually edited files",
                risk_level="low",
                explanation="Your manual changes will be preserved"
            ))

        # Sort by safety score (highest first)
        return sorted(suggestions, key=lambda s: s.safety_score, reverse=True)
```

**Phase 2: Safety Scoring (Week 2)**
```python
def _calculate_safety_score(self, impact: RollbackImpact) -> float:
    """Calculate safety score (0.0 to 1.0) for rollback."""
    score = 1.0

    # Penalize for manual changes that will be lost
    if impact.has_manual_changes:
        score -= 0.3

    # Penalize for large number of files affected
    if impact.file_count > 10:
        score -= 0.2

    # Penalize for changes to critical files
    for file in impact.files:
        if self._is_critical_file(file):  # e.g., package.json, pyproject.toml
            score -= 0.1

    # Boost for clean rollback (no conflicts)
    if not impact.has_conflicts:
        score += 0.1

    return max(0.0, min(1.0, score))
```

**Phase 3: CLI Integration (Week 2)**
```bash
# New CLI command:
claude-rewind suggest-rollback <snapshot-id>

# Example output:
#
# 🎯 Smart Rollback Suggestions for snapshot cr_abc123
#
# ✅ RECOMMENDED (Safety: 95%)
#    Rollback only 2 problematic files
#    └─ These files likely contain the issue: auth.py, utils.py
#    └─ Risk: LOW - No manual changes affected
#
# ⚠️  ALTERNATIVE (Safety: 70%)
#    Full rollback (12 files)
#    └─ Warning: You have manual changes in 3 files
#    └─ Risk: MEDIUM - Consider using --preserve-manual flag
#
# 💡 TIP (Safety: 90%)
#    Rollback but preserve manually edited files
#    └─ Your manual changes in config.py, README.md will be preserved
#    └─ Risk: LOW - Best of both worlds
```

**Phase 4: Web Dashboard Integration (Week 3)**
```javascript
// SuggestionPanel component
function RollbackSuggestions({ snapshotId }) {
    const [suggestions, setSuggestions] = useState([]);

    useEffect(() => {
        fetch(`/api/suggestions/rollback/${snapshotId}`)
            .then(r => r.json())
            .then(setSuggestions);
    }, [snapshotId]);

    return (
        <div className="suggestions-panel">
            <h3>🎯 Smart Rollback Suggestions</h3>
            {suggestions.map(s => (
                <SuggestionCard
                    key={s.type}
                    suggestion={s}
                    onExecute={() => executeRollback(s)}
                />
            ))}
        </div>
    );
}
```

#### Deliverables
- ✅ Rollback suggestion engine with safety scoring
- ✅ CLI `suggest-rollback` command
- ✅ Web dashboard suggestions panel
- ✅ VSCode extension rollback wizard
- ✅ Comprehensive testing with various scenarios

---

## 📅 Implementation Timeline

### Week 1-3: Web Dashboard
- **Week 1**: Backend API (FastAPI, endpoints, WebSocket)
- **Week 2**: Frontend core (React, timeline, diff viewer)
- **Week 3**: Polish and CLI integration

### Week 4-6: VSCode Extension
- **Week 4**: Extension scaffold and timeline sidebar
- **Week 5**: Inline diff markers and previews
- **Week 6**: Command palette integration and publish

### Week 7-8: Real-Time Diff Streaming
- **Week 7**: Streaming engine and WebSocket integration
- **Week 8**: Client-side display (web + VSCode)

### Week 9-11: Smart Rollback Suggestions
- **Week 9**: Analyzer and safety scoring
- **Week 10**: CLI integration
- **Week 11**: UI integration (web + VSCode)

### Week 12: Polish & Release
- Documentation updates
- Tutorial videos
- Release blog post
- v1.5 launch

**Total Duration**: ~3 months

---

## 🏗️ Technical Stack

### Backend
- **FastAPI**: REST API server
- **WebSockets**: Real-time communication
- **watchdog**: File system monitoring
- **Existing SnapshotEngine**: No changes needed

### Frontend (Web Dashboard)
- **React 18 + TypeScript**: UI framework
- **TailwindCSS**: Styling
- **D3.js**: Timeline visualization
- **Monaco Editor**: Code diff viewer
- **Vite**: Build tool

### VSCode Extension
- **TypeScript**: Extension language
- **VSCode Extension API**: Core functionality
- **WebView API**: Custom UI panels

### Testing
- **pytest**: Backend tests
- **Jest + React Testing Library**: Frontend tests
- **VSCode Extension Test Runner**: Extension tests

---

## 📊 Success Metrics

### Web Dashboard
- [ ] Timeline renders 1000+ snapshots smoothly
- [ ] Diff viewer handles files up to 10,000 lines
- [ ] WebSocket updates < 100ms latency
- [ ] Dashboard loads in < 2 seconds

### VSCode Extension
- [ ] Extension activates in < 1 second
- [ ] Timeline sidebar updates in real-time
- [ ] Inline diffs render without editor lag
- [ ] Published with 4+ star rating

### Real-Time Streaming
- [ ] Diffs stream with < 200ms delay
- [ ] Handles 100+ file changes per minute
- [ ] Memory usage < 100MB for streaming
- [ ] Zero dropped events

### Smart Suggestions
- [ ] Suggestions generated in < 1 second
- [ ] 90%+ accuracy in identifying problematic files
- [ ] Safety scores correlate with actual risk
- [ ] User satisfaction > 80%

---

## 🚀 Getting Started

### For Web Dashboard
```bash
# Install dependencies
cd claude_rewind/web
npm install

# Start development server
npm run dev

# In another terminal, start backend
claude-rewind serve --dev
```

### For VSCode Extension
```bash
# Install dependencies
cd vscode-extension
npm install

# Open in VSCode and press F5 to debug
code .
```

### For Testing
```bash
# Run all tests
pytest tests/

# Run specific feature tests
pytest tests/test_web_dashboard.py
pytest tests/test_vscode_extension.py
pytest tests/test_streaming.py
pytest tests/test_suggestions.py
```

---

## 📝 Documentation Plan

### User Documentation
- [ ] Web dashboard user guide with screenshots
- [ ] VSCode extension tutorial with GIFs
- [ ] Real-time streaming setup guide
- [ ] Smart suggestions explanation

### Developer Documentation
- [ ] API reference for FastAPI endpoints
- [ ] Extension API for VSCode integration
- [ ] WebSocket protocol specification
- [ ] Suggestion algorithm documentation

---

## 🎯 v1.5 Completion Checklist

- [ ] Web dashboard deployed and accessible
- [ ] VSCode extension published on marketplace
- [ ] Real-time diff streaming operational
- [ ] Smart rollback suggestions working
- [ ] All documentation updated
- [ ] Tutorial videos created
- [ ] Release blog post published
- [ ] Community feedback collected

---

## 🔗 Dependencies

### New Python Packages
```txt
fastapi>=0.104.0
uvicorn[standard]>=0.24.0
websockets>=12.0
watchdog>=3.0.0
python-multipart>=0.0.6
```

### New Node Packages
```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "d3": "^7.8.5",
    "@monaco-editor/react": "^4.6.0",
    "tailwindcss": "^3.4.0",
    "@types/vscode": "^1.85.0"
  }
}
```

---

## 💡 Key Design Principles

1. **Non-Invasive**: All v1.5 features build on top of v1.0 without breaking changes
2. **Optional**: Users can use CLI-only, or opt into web/VSCode features
3. **Performance**: Real-time features must not slow down Claude Code sessions
4. **Incremental**: Each feature can be released independently
5. **User-Centric**: Focus on solving real user pain points

---

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
